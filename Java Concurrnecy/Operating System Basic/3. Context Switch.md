# 3. Context Switch

## Context Switch
하나의 CPU는 동일한 시간에 하나의 작업(Task)만 수행할 수 있기 때문에 여러 프로세스를 동시에 실행할 수 없다. 여러 프로세스를 동시성으로 처리하기 위해서는 CPU를 할당 받아 작업을 처리중이던 프로세스에서 다른 프로세스로 전환해야 하는데 이것을 컨텍스트 스위칭이라고 한다. 컨텍스트 스위칭 시 CPU는 프로세스 간 PCB 정보를 교체하고 캐시를 비우는 과정을 수행한다.

## PCB(Process Control Block)
프로세스간 전환을 위해서는 이전에 어디까지 명령을 수행했고 CPU register에는 어떤 값이 저장되어 있는지에 대한 정보가 필요하다. 이러한 정보를 context라고 하며 이 정보들은 운영체제가 관리하는 PCB라는 자료구조 공간에 저장된다.

## TCB(Thread Control Block)
스레드 상태 정보를 저장하는 자료구조이며 PC와 register set(CPU 정보) 그리고 PCB를 가리키는 포인터를 가진다. 스레드가 하나 생성될 때마다 PCB내에서 TCB가 생성되며 컨텍스트 스위칭이 일어나면 기존의 스레드 TCB를 저장하고 새로운 스레드의 TCB를 가져와 실행한다.

프로세스 간 컨텍스트 스위칭은 레지스터, 캐시 메모리, TLB, MMU 주소 체계 수정 등의 초기화 작업이 필요하기 때문에 오버헤드가 크다. 하지만 스레드는 프로세의 메모리 영역을 공유하기 때문에 메모리 주소에 관련된 추가적인 작업이 필요 없어 프로세스 간 컨텍스트 스위칭에 비해 오버헤드가 적어서 컨텍스트 스위칭이 빠르다.

스레드는 생성하는 비용이 커서 많은 수의 스레드를 생성 시 메모리 부족 현상이 발생할 수 있으며 빈번한 컨텍스트 스위칭으로 인해 애플리케이션의 성능이 저하될 수 있다. 대부분의 애플리케이션에서는 적정 수의 스레드를 생성 해놓고 재사용하는 스레드 풀이라는 것을 사용한다.